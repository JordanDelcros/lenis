{"version":3,"file":"lenis.js","sources":["../src/maths.js","../src/animate.js","../src/nanoevents.js","../src/observed-element.js","../src/virtual-scroll.js","../src/index.js"],"sourcesContent":["// Clamp a value between a minimum and maximum value\nexport function clamp(min, input, max) {\n  return Math.max(min, Math.min(input, max))\n}\n\n// Truncate a floating-point number to a specified number of decimal places\nexport function truncate(value, decimals = 0) {\n  return parseFloat(value.toFixed(decimals))\n}\n\n// Linearly interpolate between two values using an amount (0 <= amt <= 1)\nexport function lerp(start, end, amt) {\n  return (1 - amt) * start + amt * end\n}\n\n// Calculate the modulo of the dividend and divisor while keeping the result within the same sign as the divisor\nexport function clampedModulo(dividend, divisor) {\n  const remainder = dividend % divisor\n\n  // If the remainder and divisor have different signs, adjust the remainder\n  if ((divisor > 0 && remainder < 0) || (divisor < 0 && remainder > 0)) {\n    return remainder + divisor\n  }\n\n  return remainder\n}\n","import { clamp, lerp } from './maths'\n\n// Animate class to handle value animations with lerping or easing\nexport class Animate {\n  // Advance the animation by the given delta time\n  advance(deltaTime) {\n    if (!this.isRunning) return\n\n    let completed = false\n\n    if (this.lerp) {\n      this.value = lerp(this.value, this.to, this.lerp)\n      if (Math.round(this.value) === this.to) {\n        this.value = this.to\n        completed = true\n      }\n    } else {\n      this.currentTime += deltaTime\n      const linearProgress = clamp(0, this.currentTime / this.duration, 1)\n\n      completed = linearProgress >= 1\n      const easedProgress = completed ? 1 : this.easing(linearProgress)\n      this.value = this.from + (this.to - this.from) * easedProgress\n    }\n\n    // Call the onUpdate callback with the current value and completed status\n    this.onUpdate?.(this.value, { completed })\n\n    if (completed) {\n      this.stop()\n    }\n  }\n\n  // Stop the animation\n  stop() {\n    this.isRunning = false\n  }\n\n  // Set up the animation from a starting value to an ending value\n  // with optional parameters for lerping, duration, easing, and onUpdate callback\n  fromTo(from, to, { lerp = 0.1, duration = 1, easing = (t) => t, onUpdate }) {\n    this.from = this.value = from\n    this.to = to\n    this.lerp = lerp\n    this.duration = duration\n    this.easing = easing\n    this.currentTime = 0\n    this.isRunning = true\n\n    this.onUpdate = onUpdate\n  }\n}\n","export const createNanoEvents = () => ({\n  events: {},\n\n  // Emit an event with the provided arguments\n  emit(event, ...args) {\n    const callbacks = this.events[event] || []\n    for (let i = 0, length = callbacks.length; i < length; i++) {\n      callbacks[i](...args)\n    }\n  },\n\n  // Register a callback for the specified event\n  on(event, cb) {\n    // Add the callback to the event's callback list, or create a new list with the callback\n    ;(this.events[event] ??= []).push(cb)\n\n    // Return an unsubscribe function\n    return () => {\n      this.events[event] = this.events[event].filter((i) => cb !== i)\n    }\n  },\n})\n","export class ObservedElement {\n  constructor(element) {\n    this.element = element\n\n    // If the element is the window, add a resize event listener and trigger it initially\n    if (element === window) {\n      window.addEventListener('resize', this.onWindowResize.bind(this))\n      this.onWindowResize()\n    } else {\n      // If the element is not the window, observe its size using ResizeObserver\n      this.width = this.element.offsetWidth\n      this.height = this.element.offsetHeight\n\n      this.resizeObserver = new ResizeObserver(this.onResize.bind(this))\n      this.resizeObserver.observe(this.element)\n    }\n  }\n\n  // Clean up event listeners and disconnect the ResizeObserver when destroying the instance\n  destroy() {\n    window.removeEventListener('resize', this.onWindowResize.bind(this))\n    this.resizeObserver.disconnect()\n  }\n\n  // Update the width and height properties based on the observed element's size\n  onResize([entry]) {\n    if (entry) {\n      const { width, height } = entry.contentRect\n      this.width = width\n      this.height = height\n    }\n  }\n\n  // Update the width and height properties based on the window's size\n  onWindowResize() {\n    this.width = window.innerWidth\n    this.height = window.innerHeight\n  }\n}\n","import { clamp } from './maths'\nimport { createNanoEvents } from './nanoevents'\n\nexport class VirtualScroll {\n  constructor(\n    element,\n    { wheelMultiplier = 1, touchMultiplier = 2, normalizeWheel = false }\n  ) {\n    this.element = element\n    this.wheelMultiplier = wheelMultiplier\n    this.touchMultiplier = touchMultiplier\n    this.normalizeWheel = normalizeWheel\n\n    this.touchStart = {\n      x: null,\n      y: null,\n    }\n\n    this.emitter = createNanoEvents()\n\n    this.element.addEventListener('wheel', this.onWheel, { passive: false })\n    this.element.addEventListener('touchstart', this.onTouchStart, {\n      passive: false,\n    })\n    this.element.addEventListener('touchmove', this.onTouchMove, {\n      passive: false,\n    })\n  }\n\n  // Add an event listener for the given event and callback\n  on(event, callback) {\n    return this.emitter.on(event, callback)\n  }\n\n  // Remove all event listeners and clean up\n  destroy() {\n    this.emitter.events = {}\n\n    this.element.removeEventListener('wheel', this.onWheel, {\n      passive: false,\n    })\n    this.element.removeEventListener('touchstart', this.onTouchStart, {\n      passive: false,\n    })\n    this.element.removeEventListener('touchmove', this.onTouchMove, {\n      passive: false,\n    })\n  }\n\n  // Event handler for 'touchstart' event\n  onTouchStart = (event) => {\n    const { pageX, pageY } = event.targetTouches\n      ? event.targetTouches[0]\n      : event\n\n    this.touchStart.x = pageX\n    this.touchStart.y = pageY\n  }\n\n  // Event handler for 'touchmove' event\n  onTouchMove = (event) => {\n    const { pageX, pageY } = event.targetTouches\n      ? event.targetTouches[0]\n      : event\n\n    const deltaX = -(pageX - this.touchStart.x) * this.touchMultiplier\n    const deltaY = -(pageY - this.touchStart.y) * this.touchMultiplier\n\n    this.touchStart.x = pageX\n    this.touchStart.y = pageY\n\n    this.emitter.emit('scroll', {\n      type: 'touch',\n      deltaX,\n      deltaY,\n      event,\n    })\n  }\n\n  // Event handler for 'wheel' event\n  onWheel = (event) => {\n    let { deltaX, deltaY } = event\n\n    if (this.normalizeWheel) {\n      deltaX = clamp(-100, deltaX, 100)\n      deltaY = clamp(-100, deltaY, 100)\n    }\n\n    deltaX *= this.wheelMultiplier\n    deltaY *= this.wheelMultiplier\n\n    this.emitter.emit('scroll', { type: 'wheel', deltaX, deltaY, event })\n  }\n}\n","import { version } from '../package.json'\nimport { Animate } from './animate'\nimport { clamp, clampedModulo } from './maths'\nimport { createNanoEvents } from './nanoevents'\nimport { ObservedElement } from './observed-element'\nimport { VirtualScroll } from './virtual-scroll'\n\n// Technical explaination\n// - listen to 'wheel' events\n// - prevent 'wheel' event to prevent scroll\n// - normalize wheel delta\n// - add delta to targetScroll\n// - animate scroll to targetScroll (smooth context)\n// - if animation is not running, listen to 'scroll' events (native context)\n\nexport default class Lenis {\n  // isScrolling = true when scroll is animating\n  // isStopped = true if user should not be able to scroll - enable/disable programatically\n  // isSmooth = true if scroll should be animated\n  // isLocked = same as isStopped but enabled/disabled when scroll reaches target\n\n  /**\n   * @typedef {(t: number) => number} EasingFunction\n   * @typedef {'vertical' | 'horizontal'} Orientation\n   * @typedef {'vertical' | 'horizontal' | 'both'} GestureOrientation\n   *\n   * @typedef LenisOptions\n   * @property {Orientation} [direction]\n   * @property {GestureOrientation} [gestureDirection]\n   * @property {number} [mouseMultiplier]\n   * @property {boolean} [smooth]\n   *\n   * @property {Window | HTMLElement} [wrapper]\n   * @property {HTMLElement} [content]\n   * @property {boolean} [smoothWheel]\n   * @property {boolean} [smoothTouch]\n   * @property {number} [duration]\n   * @property {EasingFunction} [easing]\n   * @property {number} [lerp]\n   * @property {boolean} [infinite]\n   * @property {Orientation} [orientation]\n   * @property {GestureOrientation} [gestureOrientation]\n   * @property {number} [touchMultiplier]\n   * @property {number} [wheelMultiplier]\n   * @property {boolean} [normalizeWheel]\n   *\n   * @param {LenisOptions}\n   */\n  constructor({\n    //--legacy options--//\n    direction,\n    gestureDirection,\n    mouseMultiplier,\n    smooth,\n    //--legacy options--//\n    wrapper = window,\n    content = document.documentElement,\n    smoothWheel = smooth ?? true,\n    smoothTouch = false,\n    duration, // in seconds\n    easing = (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),\n    lerp = duration ? null : 0.1,\n    infinite = false,\n    orientation = direction ?? 'vertical', // vertical, horizontal\n    gestureOrientation = gestureDirection ?? 'vertical', // vertical, horizontal, both\n    touchMultiplier = 2,\n    wheelMultiplier = mouseMultiplier ?? 1,\n    normalizeWheel = true,\n  } = {}) {\n    // warn about legacy options\n    if (direction) {\n      console.warn(\n        'Lenis: `direction` option is deprecated, use `orientation` instead'\n      )\n    }\n    if (gestureDirection) {\n      console.warn(\n        'Lenis: `gestureDirection` option is deprecated, use `gestureOrientation` instead'\n      )\n    }\n    if (mouseMultiplier) {\n      console.warn(\n        'Lenis: `mouseMultiplier` option is deprecated, use `wheelMultiplier` instead'\n      )\n    }\n    if (smooth) {\n      console.warn(\n        'Lenis: `smooth` option is deprecated, use `smoothWheel` instead'\n      )\n    }\n\n    window.lenisVersion = version\n\n    // if wrapper is html or body, fallback to window\n    if (wrapper === document.documentElement || wrapper === document.body) {\n      wrapper = window\n    }\n\n    this.options = {\n      wrapper,\n      content,\n      smoothWheel,\n      smoothTouch,\n      duration,\n      easing,\n      lerp,\n      infinite,\n      gestureOrientation,\n      orientation,\n      touchMultiplier,\n      wheelMultiplier,\n      normalizeWheel,\n    }\n\n    this.wrapper = new ObservedElement(wrapper)\n    this.content = new ObservedElement(content)\n\n    this.rootElement.classList.add('lenis')\n\n    this.velocity = 0\n    this.isStopped = false\n    this.isSmooth = smoothWheel || smoothTouch\n    this.isScrolling = false\n    this.targetScroll = this.animatedScroll = this.actualScroll\n    this.animate = new Animate()\n    this.emitter = createNanoEvents()\n    this.plugins = []\n\n    this.wrapper.element.addEventListener('scroll', this.onScroll, {\n      passive: false,\n    })\n\n    this.virtualScroll = new VirtualScroll(wrapper, {\n      touchMultiplier,\n      wheelMultiplier,\n      normalizeWheel,\n    })\n    this.virtualScroll.on('scroll', this.onVirtualScroll)\n\n    this.initializePlugins()\n  }\n\n  destroy() {\n    this.emitter.events = {}\n\n    this.wrapper.element.removeEventListener('scroll', this.onScroll, {\n      passive: false,\n    })\n\n    this.virtualScroll.destroy()\n  }\n\n  on(event, callback) {\n    return this.emitter.on(event, callback)\n  }\n\n  off(event, callback) {\n    this.emitter.events[event] = this.emitter.events[event]?.filter(\n      (i) => callback !== i\n    )\n  }\n\n  setScroll(scroll) {\n    // apply scroll value immediately\n    if (this.isHorizontal) {\n      this.rootElement.scrollLeft = scroll\n    } else {\n      this.rootElement.scrollTop = scroll\n    }\n  }\n\n  onVirtualScroll({ type, deltaX, deltaY, event }) {\n    // keep zoom feature\n    if (event.ctrlKey) return\n\n    // keep previous/next page gesture on trackpads\n    if (\n      (this.options.gestureOrientation === 'vertical' && deltaY === 0) ||\n      (this.options.gestureOrientation === 'horizontal' && deltaX === 0)\n    )\n      return\n\n    // catch if scrolling on nested scroll elements\n    if (\n      !!event\n        .composedPath()\n        .find((node) => node?.hasAttribute?.('data-lenis-prevent'))\n    )\n      return\n\n    if (this.isStopped || this.isLocked) {\n      event.preventDefault()\n      return\n    }\n\n    this.isSmooth =\n      (this.options.smoothTouch && type === 'touch') ||\n      (this.options.smoothWheel && type === 'wheel')\n\n    if (!this.isSmooth) {\n      this.isScrolling = false\n      this.animate.stop()\n      return\n    }\n\n    event.preventDefault()\n\n    let delta = deltaY\n    if (this.options.gestureOrientation === 'both') {\n      delta = Math.abs(deltaY) > Math.abs(deltaX) ? deltaY : deltaX\n    } else if (this.options.gestureOrientation === 'horizontal') {\n      delta = deltaX\n    }\n\n    this.scrollTo(this.targetScroll + delta, { programmatic: false })\n  }\n\n  emit() {\n    this.emitter.emit('scroll', this)\n  }\n\n  onScroll() {\n    if (!this.isScrolling) {\n      const lastScroll = this.animatedScroll\n      this.animatedScroll = this.targetScroll = this.actualScroll\n      this.velocity = 0\n      this.direction = Math.sign(this.animatedScroll - lastScroll)\n      this.emit()\n    }\n  }\n\n  reset() {\n    this.isLocked = false\n    this.isScrolling = false\n    this.velocity = 0\n  }\n\n  start() {\n    this.isStopped = false\n\n    this.reset()\n  }\n\n  stop() {\n    this.isStopped = true\n    this.animate.stop()\n\n    this.reset()\n  }\n\n  raf(time) {\n    const deltaTime = time - (this.time || time)\n    this.time = time\n\n    this.animate.advance(deltaTime * 0.001)\n  }\n\n  scrollTo(\n    target,\n    {\n      offset = 0,\n      immediate = false,\n      lock = false,\n      duration = this.options.duration,\n      easing = this.options.easing,\n      lerp = !duration && this.options.lerp,\n      onComplete,\n      force = false, // scroll even if stopped\n      programmatic = true, // called from outside of the class\n    } = {}\n  ) {\n    if (this.isStopped && !force) return\n\n    // keywords\n    if (['top', 'left', 'start'].includes(target)) {\n      target = 0\n    } else if (['bottom', 'right', 'end'].includes(target)) {\n      target = this.limit\n    } else {\n      let node\n\n      if (typeof target === 'string') {\n        // CSS selector\n        node = document.querySelector(target)\n      } else if (target?.nodeType) {\n        // Node element\n        node = target\n      }\n\n      if (node) {\n        if (this.wrapper.element !== window) {\n          // nested scroll offset correction\n          const wrapperRect = this.wrapper.element.getBoundingClientRect()\n          offset -= this.isHorizontal ? wrapperRect.left : wrapperRect.top\n        }\n\n        const rect = node.getBoundingClientRect()\n\n        target =\n          (this.isHorizontal ? rect.left : rect.top) + this.animatedScroll\n      }\n    }\n\n    if (typeof target !== 'number') return\n\n    target += offset\n    target = Math.round(target)\n\n    if (this.options.infinite) {\n      if (programmatic) {\n        this.targetScroll = this.animatedScroll = this.scroll\n      }\n    } else {\n      target = clamp(0, target, this.limit)\n    }\n\n    if (immediate) {\n      this.animatedScroll = this.targetScroll = target\n      this.setScroll(this.scroll)\n      this.animate.stop()\n      this.reset()\n      this.emit()\n      onComplete?.()\n      return\n    }\n\n    if (!programmatic) {\n      this.targetScroll = target\n    }\n\n    this.animate.fromTo(this.animatedScroll, target, {\n      duration,\n      easing,\n      lerp,\n      onUpdate: (value, { completed }) => {\n        // started\n        if (lock) this.isLocked = true\n        this.isScrolling = true\n\n        // updated\n        this.velocity = value - this.animatedScroll\n        this.direction = Math.sign(this.velocity)\n\n        this.animatedScroll = value\n        this.setScroll(this.scroll)\n\n        if (programmatic) {\n          // wheel during programmatic should stop it\n          this.targetScroll = value\n        }\n\n        // completed\n        if (completed) {\n          if (lock) this.isLocked = false\n          requestAnimationFrame(() => {\n            //avoid double scroll event\n            this.isScrolling = false\n          })\n          this.velocity = 0\n          onComplete?.()\n        }\n\n        this.emit()\n      },\n    })\n  }\n\n  registerPlugin(plugin) {\n    if (typeof plugin !== 'function') {\n      throw new Error('Plugin must be a function')\n    }\n    this.plugins.push(plugin)\n  }\n\n  initializePlugins() {\n    this.plugins.forEach((plugin) => {\n      plugin(this)\n    })\n  }\n\n  get rootElement() {\n    return this.wrapper.element === window\n      ? this.content.element\n      : this.wrapper.element\n  }\n\n  get limit() {\n    return Math.round(\n      this.isHorizontal\n        ? this.content.width - this.wrapper.width\n        : this.content.height - this.wrapper.height\n    )\n  }\n\n  get isHorizontal() {\n    return this.options.orientation === 'horizontal'\n  }\n\n  get actualScroll() {\n    // value browser takes into account\n    return this.isHorizontal\n      ? this.rootElement.scrollLeft\n      : this.rootElement.scrollTop\n  }\n\n  get scroll() {\n    return this.options.infinite\n      ? clampedModulo(this.animatedScroll, this.limit)\n      : this.animatedScroll\n  }\n\n  get progress() {\n    return this.scroll / this.limit\n  }\n\n  get isSmooth() {\n    return this.__isSmooth\n  }\n\n  set isSmooth(value) {\n    if (this.__isSmooth !== value) {\n      this.rootElement.classList.toggle('lenis-smooth', value)\n      this.__isSmooth = value\n    }\n  }\n\n  get isScrolling() {\n    return this.__isScrolling\n  }\n\n  set isScrolling(value) {\n    if (this.__isScrolling !== value) {\n      this.rootElement.classList.toggle('lenis-scrolling', value)\n      this.__isScrolling = value\n    }\n  }\n\n  get isStopped() {\n    return this.__isStopped\n  }\n\n  set isStopped(value) {\n    if (this.__isStopped !== value) {\n      this.rootElement.classList.toggle('lenis-stopped', value)\n      this.__isStopped = value\n    }\n  }\n}\n"],"names":["clamp","min","input","max","Math","Animate","_proto","prototype","advance","deltaTime","_this$onUpdate","this","isRunning","amt","completed","lerp","value","to","round","currentTime","linearProgress","duration","easedProgress","easing","from","onUpdate","call","stop","fromTo","_ref","_ref$lerp","_ref$duration","_ref$easing","t","createNanoEvents","events","emit","event","callbacks","i","length","apply","slice","arguments","on","cb","_this$events","_this$events$event","_this","push","filter","ObservedElement","element","window","addEventListener","onWindowResize","bind","width","offsetWidth","height","offsetHeight","resizeObserver","ResizeObserver","onResize","observe","destroy","removeEventListener","disconnect","entry","_entry$contentRect","contentRect","innerWidth","innerHeight","VirtualScroll","_ref$wheelMultiplier","wheelMultiplier","_ref$touchMultiplier","touchMultiplier","_ref$normalizeWheel","normalizeWheel","onTouchStart","_ref2","targetTouches","pageY","touchStart","x","pageX","y","onTouchMove","_ref3","deltaX","deltaY","emitter","type","onWheel","passive","callback","Lenis","_temp","direction","gestureDirection","mouseMultiplier","smooth","_ref$wrapper","wrapper","_ref$content","content","document","documentElement","_ref$smoothWheel","smoothWheel","_ref$smoothTouch","smoothTouch","pow","_ref$infinite","infinite","_ref$orientation","orientation","_ref$gestureOrientati","gestureOrientation","console","warn","lenisVersion","version","body","options","rootElement","classList","add","velocity","isStopped","isSmooth","isScrolling","targetScroll","animatedScroll","actualScroll","animate","plugins","onScroll","virtualScroll","onVirtualScroll","initializePlugins","off","_this$emitter$events$","setScroll","scroll","isHorizontal","scrollLeft","scrollTop","ctrlKey","composedPath","find","node","hasAttribute","isLocked","preventDefault","delta","abs","scrollTo","programmatic","lastScroll","sign","reset","start","raf","time","target","_temp2","_ref3$offset","offset","_ref3$immediate","immediate","_ref3$lock","lock","_ref3$duration","_ref3$easing","_ref3$lerp","onComplete","_ref3$force","force","_ref3$programmatic","includes","limit","_target","querySelector","nodeType","wrapperRect","getBoundingClientRect","left","top","rect","_ref4","requestAnimationFrame","registerPlugin","plugin","Error","_this2","forEach","key","get","remainder","divisor","__isSmooth","set","toggle","__isScrolling","__isStopped"],"mappings":"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"}